---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# LYFtools

<!-- badges: start -->
<!-- badges: end -->

The goal of LYFtools is package some of my frequently used functions for easy use.

# Installation

If you're interested, you can install the development version of LYFtools like so:

``` r
devtools::install_github('evanliu3594/LYFtools')
```

# Examples

There are some basic examples which shows you how to use LYFtools:

## random functions

###  `larger_bbox()` 

`larger_bbox()` is used to get a broader boundin box of a given sf/sfc object. The result is more suitable for gemerating a fishnet object

```{r}
library(LYFtools)
library(tidyverse)

sf::st_bbox(mapchina::china) %>% 
  stars::st_as_stars(dx = 0.1, dy = 0.1)

larger_bbox(mapchina::china, precise = 0.1) %>% 
  stars::st_as_stars(dx = 0.1, dy = 0.1)

```

### `simple_date()`
`simple_date()` is to acquire a abbreviation of the date.
```{r}
library(LYFtools)

simple_date()
simple_date(as.Date("2023-09-09"))
```

### `convert_amount()`
`convert_amount()` is used for convert and reform the values between Chinese quantifiers

```r
convert_amount(66, "兆瓦", "万千瓦")
```

### `convert_coord()`
`convert_coord()` is used for convert a set of geo-coding (long, lat) between some Chinese defined coordinate systems and WGS1984 coordinate system. Note that only works inside China domain

```r
convert_coord(133, 47, from = "GCJ02", to = "WGS84")
```

## AQI_related_funs

根据中华人民共和国生态环境部《环境空气质量指数（AQI）技术规定（HJ633—2012）》中的相关标准和方法，提供五个用于计算AQI的函数

### `DaliyMeanConc()`
`DaliyMeanConc()` calculates daily mean concentration of 6 pollutants. Note that average `O3` concentration for one day is presented by maximum 8-hour average concentration.

```{r}
C <- rnorm(24, 35, 5)
DaliyMeanConc("PM2.5", C)
```

### `IAQI_hourly()`
`IAQI_hourly()` is for calculate hourly IAQI for a given pollutant
```{r}
IAQI_hourly("O3", 142)
```

### `Calc_Hourly_AQI()`
`Calc_Hourly_AQI()` calculates the hourly AQI score and the featured pollutants based on 4 pollutants' concentration.

```{r}
Calc_Hourly_AQI(SO2 = 300,NO2 = 200,CO = 100,O3 = 120)

```

### `IAQI_Daily()`
`IAQI_Daily()` calculates daily IAQI for given pollutant

```{r}
IAQI_Daily("O3", 142)
```

### `Calc_Daily_AQI()`
`Calc_Daily_AQI()` calculate the daily AQI score and the featured pollutants based on 6 pollutants' concentration.

```{r}
Calc_Daily_AQI(SO2 = 55, NO2 = 23, CO = 12, O3 = 122, PM2.5 = 35, PM10 = 55)
```

### A complete work with AQI series functions with `dplyr`.

```{r}
library(tidyverse)
# generating sample data

sampleConc <- data.frame(
  Time = 0:23,
  SO2 = rnorm(24, mean = 300, sd = 20),
  NO2 = rnorm(24, mean = 800, sd = 100),
  O3 = rnorm(24, mean = 500, sd = 100),
  CO = rnorm(24, mean = 40, sd = 10),
  PM2.5 = rnorm(24, mean = 200, sd = 50),
  PM10 = rnorm(24, mean = 350, sd = 100)
)

sampleConc
```

## 2.求小时IAQI及AQI：
```{r}
sampleConc %>% 
    pivot_longer(-Time, names_to = 'Pollu', values_to = 'Conc') %>% 
    mutate(IAQI_h = map2_dbl(.x = Pollu, .y  = Conc, ~IAQI_hourly(.x, .y)))  %>% 
    select(- Conc) |> pivot_wider(names_from = 'Pollu', values_from = 'IAQI_h')

```
```{r}
sampleConc |> rowwise() |> 
     mutate(AQI_h = AQI_Hourely(SO2 = SO2,NO2 = NO2,CO = CO,O3 = O3), .keep = 'none')

```

## 3. 求日均IAQI及AQI
```{r}
sample_daily_conc <- sampleConc |>  DaliyMeanConc()
sample_daily_conc

sample_daily_conc |>
    pivot_longer(everything(),names_to = 'Pollu',values_to = 'Conc') |> 
    mutate(IAQI_d = map2_dbl(.x = Pollu, .y  = Conc, ~IAQI_Daily(.x, .y))) |> 
    select(- Conc) |> pivot_wider(names_from = 'Pollu', values_from = 'IAQI_d')
```
```{r}
sample_daily_conc %>%
    mutate(
      AQI_d = AQI_Daily(SO2 = SO2,NO2 = NO2,CO = CO,
                        O3 = O3,PM10 = PM10 ,PM2.5 = PM2.5),
      .keep = 'none'
    )

```
